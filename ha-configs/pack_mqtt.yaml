mqtt:
  sensor:
    #-----------------------------------------------
    # New Local MQTT for additional heatpump entries
    #-----------------------------------------------

    - name: "ebusd HMU BuildingCircuitFlow"
      unique_id: sensor.ebusd_hmu_buildingcircuitflow
      state_topic: "ebusd/hmu/BuildingCircuitFlow"
      value_template: "{{ ( value_json['value']['value'] | float(0) ) / 60 }}"
      suggested_display_precision: 3
      unit_of_measurement: "L/min"
      state_class: "measurement"
      device_class: "volume_flow_rate"
      icon: mdi:pipe-valve

    - name: "ebusd HMU COP HC"
      unique_id: sensor.ebusd_hmu_cophc
      state_topic: "ebusd/hmu/CopHc"
      value_template: "{{ value_json['value']['value'] }}"
      state_class: "measurement"
      icon: mdi:information

    - name: "ebusd HMU COP HC Month"
      unique_id: sensor.ebusd_hmu_cophc_month
      state_topic: "ebusd/hmu/CopHcMonth"
      value_template: "{{ value_json['value']['value'] }}"
      state_class: "measurement"
      icon: mdi:information

    - name: "ebusd HMU COP HWC"
      unique_id: sensor.ebusd_hmu_cophwc
      state_topic: "ebusd/hmu/CopHwc"
      value_template: "{{ value_json['value']['value'] }}"
      state_class: "measurement"
      icon: mdi:information

    - name: "ebusd HMU COP HWC Month"
      unique_id: sensor.ebusd_hmu_cophwc_month
      state_topic: "ebusd/hmu/CopHwcMonth"
      value_template: "{{ value_json['value']['value'] }}"
      state_class: "measurement"
      icon: mdi:information

    - name: "ebusd HMU CurrentError Error"
      unique_id: sensor.ebusd_hmu_currenterror_error
      state_topic: "ebusd/hmu/Currenterror"
      value_template: >
        {% if value_json['error']['value'] is none %}
          None
        {% else %}
          {{ value_json['error']['value'] }}
        {% endif %}
      icon: mdi:alert-circle

    - name: "ebusd HMU CurrentError Error 1"
      unique_id: sensor.ebusd_hmu_currenterror_error_1
      state_topic: "ebusd/hmu/Currenterror"
      value_template: >
        {% if value_json['error_1']['value'] is none %}
          None
        {% else %}
          {{ value_json['error_1']['value'] }}
        {% endif %}
      icon: mdi:alert-circle

    - name: "ebusd HMU CurrentError Error 2"
      unique_id: sensor.ebusd_hmu_currenterror_error_2
      state_topic: "ebusd/hmu/Currenterror"
      value_template: >
        {% if value_json['error_2']['value'] is none %}
          None
        {% else %}
          {{ value_json['error_2']['value'] }}
        {% endif %}
      icon: mdi:alert-circle

    - name: "ebusd HMU CurrentError Error 3"
      unique_id: sensor.ebusd_hmu_currenterror_error_3
      state_topic: "ebusd/hmu/Currenterror"
      value_template: >
        {% if value_json['error_3']['value'] is none %}
          None
        {% else %}
          {{ value_json['error_3']['value'] }}
        {% endif %}
      icon: mdi:alert-circle

    - name: "ebusd HMU CurrentError Error 4"
      unique_id: sensor.ebusd_hmu_currenterror_error_4
      state_topic: "ebusd/hmu/Currenterror"
      value_template: >
        {% if value_json['error_4']['value'] is none %}
          None
        {% else %}
          {{ value_json['error_4']['value'] }}
        {% endif %}
      icon: mdi:alert-circle

    - name: "ebusd VR71 MC1 Operation Status"
      unique_id: sensor.ebusd_vr71_mc1_operation_status
      state_topic: "ebusd/vr_71/Mc1Operation"
      value_template: "{{ value_json['status']['value'] }}"
      icon: mdi:information

    - name: "ebusd VR71 MC1 Operation Flow Temp Desired"
      unique_id: sensor.ebusd_vr71_mc1_operation_flow_temp_desired
      state_topic: "ebusd/vr_71/Mc1Operation"
      value_template: "{{ value_json['flowtempdesired']['value'] }}"
      icon: mdi:thermometer
      unit_of_measurement: "°C"
      state_class: "measurement"
      device_class: "temperature"

    - name: "ebusd VR71 MC1 Operation Pump"
      unique_id: sensor.ebusd_vr71_mc1_operation_pump
      state_topic: "ebusd/vr_71/Mc1Operation"
      value_template: "{{ value_json['pump']['value'] }}"
      icon: mdi:information

    - name: "ebusd VR71 MC1 Operation Mixer"
      unique_id: sensor.ebusd_vr71_mc1_operation_mixer
      state_topic: "ebusd/vr_71/Mc1Operation"
      value_template: "{{ value_json['mixer']['value'] }}"
      icon: mdi:information

    - name: "ebusd VR71 MC2 Operation Status"
      unique_id: sensor.ebusd_vr71_mc2_operation_status
      state_topic: "ebusd/vr_71/Mc2Operation"
      value_template: "{{ value_json['status']['value'] }}"
      icon: mdi:information

    - name: "ebusd VR71 MC2 Operation Flow Temp Desired"
      unique_id: sensor.ebusd_vr71_mc2_operation_flow_temp_desired
      state_topic: "ebusd/vr_71/Mc2Operation"
      value_template: "{{ value_json['flowtempdesired']['value'] }}"
      icon: mdi:thermometer
      unit_of_measurement: "°C"
      state_class: "measurement"
      device_class: "temperature"

    - name: "ebusd VR71 MC2 Operation Pump"
      unique_id: sensor.ebusd_vr71_mc2_operation_pump
      state_topic: "ebusd/vr_71/Mc2Operation"
      value_template: "{{ value_json['pump']['value'] }}"
      icon: mdi:information

    - name: "ebusd VR71 MC2 Operation Mixer"
      unique_id: sensor.ebusd_vr71_mc2_operation_mixer
      state_topic: "ebusd/vr_71/Mc2Operation"
      value_template: "{{ value_json['mixer']['value'] }}"
      icon: mdi:information




    #---------------------------------------
    # New Local MQTT for Glow IHD
    #---------------------------------------

    - name: "Smart Meter Electricity: Power"
      unique_id: "smart_meter_electricity_power"
      state_topic: "glow/YOURDEVICEID/SENSOR/electricitymeter"
      device_class: "power"
      unit_of_measurement: "W"
      state_class: "measurement"
      value_template: "{{ (value_json['electricitymeter']['power']['value'] * 1000) | round() }}"
      icon: "mdi:flash"

    - name: "Smart Meter Electricity: Energy Import"
      unique_id: "smart_meter_electricity_energy_import"
      state_topic: "glow/YOURDEVICEID/SENSOR/electricitymeter"
      device_class: "energy"
      unit_of_measurement: "kWh"
      state_class: "total_increasing"
      value_template: >
        {% if value_json['electricitymeter']['energy']['import']['cumulative'] == 0 %}
          {{ states('sensor.smart_meter_electricity_energy_import') }}
        {% else %}
          {{ value_json['electricitymeter']['energy']['import']['cumulative'] }}
        {% endif %}
      icon: "mdi:flash"

    - name: "Smart Meter Electricity: Energy Export"
      unique_id: "smart_meter_electricity_energy_export"
      state_topic: "glow/YOURDEVICEID/SENSOR/electricitymeter"
      device_class: "energy"
      unit_of_measurement: "kWh"
      state_class: "total_increasing"
      value_template: >
        {% if value_json['electricitymeter']['energy']['export']['cumulative'] == 0 %}
          {{ states('sensor.smart_meter_electricity_energy_export') }}
        {% else %}
          {{ value_json['electricitymeter']['energy']['export']['cumulative'] }}
        {% endif %}
      icon: "mdi:flash"

    - name: "Smart Meter Gas: Import"
      unique_id: "smart_meter_gas_import"
      state_topic: "glow/YOURDEVICEID/SENSOR/gasmeter"
      device_class: "energy"
      unit_of_measurement: "kWh"
      state_class: "total_increasing"
      value_template: >
        {% if value_json['gasmeter']['energy']['import']['cumulative'] == 0 %}
          {{ states('sensor.smart_meter_gas_import') }}
        {% else %}
          {{ value_json['gasmeter']['energy']['import']['cumulative'] }}
        {% endif %}
      icon: "mdi:fire"

    - name: "Smart Meter Electricity: Import Unit Rate"
      unique_id: "smart_meter_electricity_import_unit_rate"
      state_topic: "glow/YOURDEVICEID/SENSOR/electricitymeter"
      device_class: "monetary"
      unit_of_measurement: "GBP/kWh"
      state_class: "measurement"
      value_template: "{{ value_json['electricitymeter']['energy']['import']['price']['unitrate'] }}"
      icon: "mdi:cash"

    - name: "Smart Meter Electricity: Import Standing Charge"
      unique_id: "smart_meter_electricity_import_standing_charge"
      state_topic: "glow/YOURDEVICEID/SENSOR/electricitymeter"
      device_class: "monetary"
      unit_of_measurement: "GBP"
      state_class: "measurement"
      value_template: "{{ value_json['electricitymeter']['energy']['import']['price']['standingcharge'] }}"
      icon: "mdi:cash"

    - name: "Smart Meter Gas: Import Unit Rate"
      unique_id: "smart_meter_gas_import_unit_rate"
      state_topic: "glow/YOURDEVICEID/SENSOR/gasmeter"
      device_class: "monetary"
      unit_of_measurement: "GBP/kWh"
      state_class: "measurement"
      value_template: "{{ value_json['gasmeter']['energy']['import']['price']['unitrate'] }}"
      icon: "mdi:cash"

    - name: "Smart Meter Gas: Import Standing Charge"
      unique_id: "smart_meter_gas_import_standing_charge"
      state_topic: "glow/YOURDEVICEID/SENSOR/gasmeter"
      device_class: "monetary"
      unit_of_measurement: "GBP"
      state_class: "measurement"
      value_template: "{{ value_json['gasmeter']['energy']['import']['price']['standingcharge'] }}"
      icon: "mdi:cash"
