input_boolean:
  flag_working:
    name: Flag - Working
    icon: mdi:flag
  flag_run_airer:
    name: Flag - Run Airer
    icon: mdi:flag
  flag_hallway_light_by_motion:
    name: Flag - Hallway Light By Motion
    icon: mdi:flag

template:
  - sensor:
      - name: "State - Type of Day"
        unique_id: state_type_of_day
        state: >
          {% if now().weekday() < 5 %}Weekday
          {% else %}Weekend
          {% endif %}
        icon: mdi:calendar

      - name: "State - Tadpole School Day"
        unique_id: state_tadpole_school_day
        state: >
          {% if is_state('binary_sensor.calendar_tadpole_farm_school_holiday', 'on') %}Holiday
          {% elif is_state('binary_sensor.calendar_tadpole_farm_inset_day', 'on') %}Inset Day
          {% elif is_state('binary_sensor.flag_is_weekday', 'on') %}School Day
          {% else %}Weekend
          {% endif %}
        icon: mdi:account-school
      - name: "State - Count Of Lights On"
        unique_id: state_count_of_lights_on
        state_class: measurement
        icon: mdi:lightbulb
        state: >
          {% set entities = label_entities('__MonitoredDevice') %}
          {% set lights = entities | select('match', '^light\.') | list %}
          {{ lights | select('is_state', 'on') | list | count }}
        attributes:
          entities: >
            {% set entities = label_entities('__MonitoredDevice') %}
            {% set lights = entities | select('match', '^light\.') | list %}
            {{ lights | select('is_state', 'on') | list }}
      - name: "State - Count Of Switches On"
        unique_id: state_count_of_switches_on
        state_class: measurement
        icon: mdi:toggle-switch-variant
        state: >
          {% set entities = label_entities('__MonitoredDevice') %}
          {% set switches = entities | select('match', '^switch\.') | list %}
          {{ switches | select('is_state', 'on') | list | count }}
        attributes:
          entities: >
            {% set entities = label_entities('__MonitoredDevice') %}
            {% set switches = entities | select('match', '^switch\.') | list %}
            {{ switches | select('is_state', 'on') | list }}

  - trigger:
      - platform: event
        event_type: set_var_ai_response_weather
    sensor:
      - name: Var - AI Response - Weather
        unique_id: var_ai_response_weather
        state: "{{ now() }}"
        attributes:
          payload: "{{ trigger.event.data.payload }}"
