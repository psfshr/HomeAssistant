input_boolean:
  flag_is_tadpole_holiday:
    name: Flag - Is Tadpole Holiday
    icon: mdi:flag
  flag_working:
    name: Flag - Working
    icon: mdi:flag
  var_hallway_light_by_motion:
    name: Var - Hallway Light By Motion
    icon: mdi:flag

template:
  - binary_sensor:
      - name: "Flag - Is Weekday"
        unique_id: flag_is_weekday
        state: >
          {{ now().weekday() < 5 }}
        icon: mdi:flag

  - sensor:
      - name: "Var - Count Of Lights On"
        unique_id: var_count_of_lights_on
        state_class: measurement
        icon: mdi:lightbulb
        state: >
          {% set entities = label_entities('__MonitoredDevice') %}
          {% set lights = entities | select('match', '^light\.') | list %}
          {{ lights | select('is_state', 'on') | list | count }}
        attributes:
          entities: >
            {% set entities = label_entities('__MonitoredDevice') %}
            {% set lights = entities | select('match', '^light\.') | list %}
            {{ lights | select('is_state', 'on') | list }}
      - name: "Var - Count Of Switches On"
        unique_id: var_count_of_switches_on
        state_class: measurement
        icon: mdi:toggle-switch-variant
        state: >
          {% set entities = label_entities('__MonitoredDevice') %}
          {% set switches = entities | select('match', '^switch\.') | list %}
          {{ switches | select('is_state', 'on') | list | count }}
        attributes:
          entities: >
            {% set entities = label_entities('__MonitoredDevice') %}
            {% set switches = entities | select('match', '^switch\.') | list %}
            {{ switches | select('is_state', 'on') | list }}

  - trigger:
      - platform: event
        event_type: set_var_ai_response_weather
    sensor:
      - name: Var - AI Response - Weather
        unique_id: var_ai_response_weather
        state: "{{ now() }}"
        attributes:
          payload: "{{ trigger.event.data.payload }}"
