template:
  - sensor:
      - name: "Count Of Lights On"
        unique_id: "countlightson"
        state_class: measurement
        icon: mdi:lightbulb
        state: >
          {% set entities = label_entities('__MonitoredDevice') %}
          {% set lights = entities | select('match', '^light\.') | list %}
          {{ lights | select('is_state', 'on') | list | count }}
        attributes:
          entities: >
            {% set entities = label_entities('__MonitoredDevice') %}
            {% set lights = entities | select('match', '^light\.') | list %}
            {{ lights | select('is_state', 'on') | list }}
      - name: "Count Of Switches On"
        unique_id: "countswitcheson"
        state_class: measurement
        icon: mdi:toggle-switch-variant
        state: >
          {% set entities = label_entities('__MonitoredDevice') %}
          {% set switches = entities | select('match', '^switch\.') | list %}
          {{ switches | select('is_state', 'on') | list | count }}
        attributes:
          entities: >
            {% set entities = label_entities('__MonitoredDevice') %}
            {% set switches = entities | select('match', '^switch\.') | list %}
            {{ switches | select('is_state', 'on') | list }}
